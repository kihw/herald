# Herald.lol Gaming Analytics - Redis Configuration for Kong
# Optimized for gaming API gateway caching and rate limiting

# Gaming Network Configuration
bind 0.0.0.0
port 6379
timeout 300

# Gaming Memory Configuration
maxmemory 1gb
maxmemory-policy allkeys-lru

# Gaming Persistence (optimized for cache)
save 900 1    # Save after 900 seconds if at least 1 key changed
save 300 10   # Save after 300 seconds if at least 10 keys changed  
save 60 10000 # Save after 60 seconds if at least 10000 keys changed

# Disable RDB persistence in pure cache mode
# save ""

# Gaming AOF Configuration (for critical gaming data)
appendonly yes
appendfilename "gaming-cache.aof"
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# Gaming Performance Optimization
tcp-keepalive 60
tcp-backlog 2048

# Gaming Database Configuration (for Kong plugins)
databases 16

# Database allocation:
# 0: Default Kong cache
# 1: Gaming analytics rate limiting
# 2: Riot API rate limiting  
# 3: Gaming session storage
# 4: Gaming performance metrics
# 5: Gaming user preferences cache
# 6-15: Reserved for future gaming features

# Gaming Logging
loglevel notice
logfile "/data/gaming-redis.log"
syslog-enabled yes
syslog-ident herald-gaming-redis

# Gaming Security
requirepass herald_gaming_redis
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command DEBUG ""
rename-command CONFIG "GAMING_CONFIG_9b8e2a1f"

# Gaming Client Configuration
maxclients 10000
timeout 300

# Gaming Memory Optimization
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
list-compress-depth 0
set-max-intset-entries 512
zset-max-ziplist-entries 128
zset-max-ziplist-value 64

# Gaming Slow Query Logging
slowlog-log-slower-than 10000
slowlog-max-len 128

# Gaming Pub/Sub Configuration
notify-keyspace-events Ex

# Gaming Latency Monitoring
latency-monitor-threshold 100

# Gaming Client Output Buffer Limits
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# Gaming Stop Writes on Background Save Error
stop-writes-on-bgsave-error no

# Gaming RDB Configuration
rdbcompression yes
rdbchecksum yes

# Gaming Replica Configuration
replica-serve-stale-data yes
replica-read-only yes
repl-diskless-sync no
repl-diskless-sync-delay 5
repl-ping-replica-period 10
repl-timeout 60
repl-disable-tcp-nodelay no
replica-priority 100

# Gaming Sentinel Configuration (if using Redis Sentinel)
# sentinel announce-ip <ip>
# sentinel announce-port <port>

# Gaming Module Loading (if needed)
# loadmodule /path/to/gaming-module.so